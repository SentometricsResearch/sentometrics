---
title: "Corpus manipulation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.width = 7, fig.height = 4, fig.align = "center")
```

This tutorial provides insights in how to create, enrich, transform and analyze a corpus.

##### Preparation

```{r}
library("sentometrics")
library("quanteda")

data("usnews")
data("list_lexicons")
data("list_valence_shifters")
```

### Summarize a corpus through some statistics and plots

Quickly investigate how your corpus looks like in terms of number of documents, number of tokens and its metadata features.

```{r}
corpus <- sento_corpus(usnews)

summ1 <- corpus_summarize(corpus, by = "week")
stats <- summ1[["stats"]] # some weekly corpus statistics about tokens and features
```

```{r}
stats[, 1:6]
stats[, c(1, 7:10)]
```

```{r}
summ2 <- corpus_summarize(corpus, by = "year", features = c("wsj", "wapo"))
plots <- summ2[["plots"]]
```

```{r}
plots$doc_plot # yearly evolution of the number of documents
plots$feature_plot # yearly evolution of the presence of the "wsj" and "wapo" features
plots$token_plot # yearly evolution of the token statistics (mean, min., max.)
```

### Apply **`quanteda`** corpus functions on a `sento_corpus` object

```{r}
corpus <- sento_corpus(usnews)

res <- corpus_reshape(corpus, to = "sentences")
sam <- corpus_sample(corpus, 100)
seg <- corpus_segment(corpus, pattern = "stock", use_docvars = TRUE)
sub <- corpus_subset(corpus, wsj == 1)
tri <- corpus_trim(corpus, "documents", min_ntoken = 300)
trs <- corpus_trim(corpus, "sentences", min_ntoken = 40)
```

### Enrich a `sento_corpus` object with features 

```{r}
corpus <- sento_corpus(usnews[, 1:3])

keywords <- list(
  E = c("economy", "economic"),
  P = c("policy&regulation"),
  U = c("uncertainty", "uncertain")
)

corpus <- add_features(corpus, keywords = keywords, do.binary = TRUE, do.regex = c(FALSE, TRUE, FALSE))
docvars(corpus, "featureDummy") <- NULL

head(docvars(corpus))
```

